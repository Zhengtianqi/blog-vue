<template><div><p>国产oracle系数据库学习笔记</p>
<h1 id="一-安装" tabindex="-1"><a class="header-anchor" href="#一-安装" aria-hidden="true">#</a> 一 安装</h1>
<h2 id="_1-规划安装用户和用户组" tabindex="-1"><a class="header-anchor" href="#_1-规划安装用户和用户组" aria-hidden="true">#</a> 1 规划安装用户和用户组：</h2>
<p>不推荐使用 root 安装，规划单独的用户安装。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># groupadd dinstall
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># useradd <span class="token operator">-</span>g dinstall <span class="token operator">-</span>m <span class="token operator">-</span>d <span class="token operator">/</span>home<span class="token operator">/</span>dmdba <span class="token operator">-</span>s <span class="token operator">/</span>bin<span class="token operator">/</span>bash dmdba
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># passwd dmdba
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改用户 dmdba 的密码 。
新的 密码：
重新输入新的 密码：
passwd：所有的身份验证令牌已经成功更新。</p>
<h2 id="_2-规划安装目录" tabindex="-1"><a class="header-anchor" href="#_2-规划安装目录" aria-hidden="true">#</a> 2 规划安装目录：</h2>
<p>创建安装目录/dm8，并修改安装目录的所属组给 dmdba 用户和该用户所属组</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># mkdir <span class="token operator">/</span>dm8
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># ls <span class="token operator">-</span>ld <span class="token operator">/</span>dm8
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">2</span> root root <span class="token number">6</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">50</span> <span class="token operator">/</span>dm8
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># chown dmdba<span class="token operator">:</span>dinstall <span class="token operator">/</span>dm8
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># ls <span class="token operator">-</span>ld <span class="token operator">/</span>dm8
drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">2</span> dmdba dinstall <span class="token number">6</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">50</span> <span class="token operator">/</span>dm8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-挂载-iso-镜像文件" tabindex="-1"><a class="header-anchor" href="#_3-挂载-iso-镜像文件" aria-hidden="true">#</a> 3 挂载 iso 镜像文件：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># mkdir <span class="token operator">/</span>mnt<span class="token operator">/</span>dm
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># mount <span class="token operator">/</span>opt<span class="token operator">/</span>dm8_20210818_x86_rh6_64_ent_8<span class="token punctuation">.</span><span class="token number">4.2</span><span class="token number">.18_</span>pack14<span class="token punctuation">.</span>iso 
<span class="token operator">/</span>mnt<span class="token operator">/</span>dm
mount<span class="token operator">:</span> <span class="token operator">/</span>mnt<span class="token operator">/</span>dm<span class="token operator">:</span> <span class="token constant">WARNING</span><span class="token operator">:</span> source write<span class="token operator">-</span><span class="token keyword">protected</span><span class="token punctuation">,</span> mounted read<span class="token operator">-</span>only<span class="token punctuation">.</span>
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> opt<span class="token punctuation">]</span># su <span class="token operator">-</span> dmdba
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>mnt<span class="token operator">/</span>dm
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> dm<span class="token punctuation">]</span>$ ll
总用量 <span class="token number">739440</span>
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">2784248</span> <span class="token number">8</span> 月 <span class="token number">23</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">36</span> '<span class="token constant">DM8</span> <span class="token class-name">Install</span><span class="token punctuation">.</span>pdf'
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">754402133</span> <span class="token number">8</span> 月 <span class="token number">23</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">40</span> <span class="token class-name">DMInstall</span><span class="token punctuation">.</span>bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-安装方式" tabindex="-1"><a class="header-anchor" href="#_4-安装方式" aria-hidden="true">#</a> 4 安装方式：</h2>
<p>（1）第一次启动虚拟机，执行下 xhost +</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> 桌面<span class="token punctuation">]</span># xhost <span class="token operator">+</span>
access control disabled<span class="token punctuation">,</span> clients can connect from any host
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）查看 root 用户的 DISPLAY 变量值</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> 桌面<span class="token punctuation">]</span># echo $<span class="token constant">DISPLAY</span>
<span class="token operator">:</span><span class="token number">0.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）切换 dmdba 用户</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> 桌面<span class="token punctuation">]</span># su <span class="token operator">-</span> dmdba
上一次登录： 一 <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">54</span><span class="token operator">:</span><span class="token number">09</span> <span class="token constant">CST</span> <span class="token number">2021</span> pts<span class="token operator">/</span><span class="token number">1</span> 上
（<span class="token number">4</span>）设置 dmdba 用户的 <span class="token constant">DISPLAY</span> 变量值为步骤（<span class="token number">1</span>）中的值（仅对当前会话生效）
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ export <span class="token constant">DISPLAY</span><span class="token operator">=</span><span class="token operator">:</span><span class="token number">0.0</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>mnt<span class="token operator">/</span>dm
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> dm<span class="token punctuation">]</span>$ ll
总用量 <span class="token number">739440</span>
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">2784248</span> <span class="token number">8</span> 月 <span class="token number">23</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">36</span> '<span class="token constant">DM8</span> <span class="token class-name">Install</span><span class="token punctuation">.</span>pdf'
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">754402133</span> <span class="token number">8</span> 月 <span class="token number">23</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">40</span> <span class="token class-name">DMInstall</span><span class="token punctuation">.</span>bin
## <span class="token number">2</span> 图形化界面方式安装 <span class="token constant">DM</span> 数据库
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> dm<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DMInstall</span><span class="token punctuation">.</span>bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装时报 tmp 不足的解决方法
如果安装时报错 tmp 不足，可以设置 DM_INSTALL_TMPDIR 变量，指定到别的路径下(存
储空间大于 2G)。
设置参考如下：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> opt<span class="token punctuation">]</span># mkdir tmp
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> opt<span class="token punctuation">]</span># chown dmdba<span class="token operator">:</span>dinstall <span class="token operator">/</span>opt<span class="token operator">/</span>tmp
或
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> opt<span class="token punctuation">]</span># chmod <span class="token number">777</span> <span class="token operator">/</span>opt<span class="token operator">/</span>tmp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> opt<span class="token punctuation">]</span># su <span class="token operator">-</span> dmdba
上一次登录： 四 <span class="token number">6</span> 月 <span class="token number">30</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">06</span><span class="token operator">:</span><span class="token number">43</span> <span class="token constant">CST</span> <span class="token number">2022</span> pts<span class="token operator">/</span><span class="token number">1</span> 上
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ export <span class="token constant">DM_INSTALL_TMPDIR</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>tmp
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>mnt<span class="token operator">/</span>dm
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> dm<span class="token punctuation">]</span>$ ll
总用量 <span class="token number">927088</span>
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">2802237</span> <span class="token number">3</span> 月 <span class="token number">4</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">39</span> '<span class="token constant">DM8</span> <span class="token class-name">Install</span><span class="token punctuation">.</span>pdf'
<span class="token operator">-</span>r<span class="token operator">-</span>xr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> root root <span class="token number">946534466</span> <span class="token number">3</span> 月 <span class="token number">4</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">44</span> <span class="token class-name">DMInstall</span><span class="token punctuation">.</span>bin
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> dm<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DMInstall</span><span class="token punctuation">.</span>bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（5）设置文件打开数</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>vim <span class="token operator">/</span>etc<span class="token operator">/</span>security<span class="token operator">/</span>limits<span class="token punctuation">.</span>conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（6）界面提示使用 root 用户执行如下脚本</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> 桌面<span class="token punctuation">]</span># <span class="token operator">/</span>dm8<span class="token operator">/</span>script<span class="token operator">/</span>root<span class="token operator">/</span>root_installer<span class="token punctuation">.</span>sh
移动 <span class="token operator">/</span>dm8<span class="token operator">/</span>bin<span class="token operator">/</span>dm_svc<span class="token punctuation">.</span>conf 到<span class="token operator">/</span>etc 目录
修改服务器权限
创建 <span class="token class-name">DmAPService</span> 服务
<span class="token class-name">Created</span> symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span><span class="token class-name">DmAPService</span><span class="token punctuation">.</span>service →
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span><span class="token class-name">DmAPService</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>
创建服务<span class="token punctuation">(</span><span class="token class-name">DmAPService</span><span class="token punctuation">)</span>完成
启动 <span class="token class-name">DmAPService</span> 服务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-卸载-dm-数据库" tabindex="-1"><a class="header-anchor" href="#_5-卸载-dm-数据库" aria-hidden="true">#</a> 5 卸载 DM 数据库</h2>
<p>图形化卸载 DM 数据库
DM 安装目录下执行./uninstall.sh 卸载 DM 数据库：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> dm8<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/uninstall<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>界面提示使用 root 用户执行如下脚本</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> 桌面<span class="token punctuation">]</span># <span class="token operator">/</span>dm8<span class="token operator">/</span>root_uninstaller<span class="token punctuation">.</span>sh
删除 <span class="token class-name">DmAPService</span> 服务
<span class="token class-name">Removed</span> <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span><span class="token class-name">DmAPService</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>
删除<span class="token operator">/</span>etc<span class="token operator">/</span>dm_svc<span class="token punctuation">.</span>conf 文件
命令行方式卸载 <span class="token constant">DM</span> 数据库
<span class="token constant">DM</span> 安装目录下执行<span class="token punctuation">.</span>/uninstall<span class="token punctuation">.</span>sh <span class="token operator">-</span>i 卸载 <span class="token constant">DM</span> 数据库：
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> dm8<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/uninstall<span class="token punctuation">.</span>sh <span class="token operator">-</span>i
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="二-创建数据库及数据库实例管理" tabindex="-1"><a class="header-anchor" href="#二-创建数据库及数据库实例管理" aria-hidden="true">#</a> 二 创建数据库及数据库实例管理</h1>
<h2 id="方式1-dm-数据库配置助手图形化界面方式创建数据库" tabindex="-1"><a class="header-anchor" href="#方式1-dm-数据库配置助手图形化界面方式创建数据库" aria-hidden="true">#</a> 方式1 DM 数据库配置助手图形化界面方式创建数据库</h2>
<p>（1）运行 <a href="http://dbca.sh" target="_blank" rel="noopener noreferrer">dbca.sh<ExternalLinkIcon/></a> 创建数据库</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>dm8<span class="token operator">/</span>tool
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/dbca<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>簇大小 页大小 字符集 大小写敏感 VARCHAR 类型以字符为单位等一旦指定，数据库创建完成将无法更改。页是达梦数据库的最小存储单元，达梦中 varchar 类型长度默认不能大于页大小的一半。
VARCHAR 类型以字符为单位（默认以字节为单位）
以字节为单位：
Varchar(10), gb18030 字符集，一个中文占用两个字节，Varchar(10)只能保存五个中文。
Varchar(10), utf-8 字符集，一个中文占用三个字节，Varchar(10)只能保存三个中文。
以字符为单位：
Varchar(10),不管什么字符集，Varchar(10)都能保存十个中文。</p>
<p>（2）界面提示使用 root 用户执行脚本：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> network<span class="token operator">-</span>scripts<span class="token punctuation">]</span># mv <span class="token operator">/</span>dm8<span class="token operator">/</span>bin<span class="token operator">/</span><span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span><span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> network<span class="token operator">-</span>scripts<span class="token punctuation">]</span># systemctl enable <span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service
<span class="token class-name">Created</span> symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span><span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service →
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span><span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> network<span class="token operator">-</span>scripts<span class="token punctuation">]</span># systemctl start <span class="token class-name">DmServiceDMSERVER</span><span class="token punctuation">.</span>service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="方式2-dminit-命令行创建数据库实例" tabindex="-1"><a class="header-anchor" href="#方式2-dminit-命令行创建数据库实例" aria-hidden="true">#</a> 方式2 dminit 命令行创建数据库实例</h2>
<p>dminit 创建 DM 数据库
dminit 是 DM 初始化数据库的命令行工具，位于 DM 安装目录 bin 下。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/dminit help
关键字                          说明（默认值）
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token constant">INI_FILE</span>                      初始化文件dm<span class="token punctuation">.</span>ini存放的路径
<span class="token constant">PATH</span>                          初始化数据库存放的路径
<span class="token constant">CTL_PATH</span>                      控制文件路径
<span class="token constant">LOG_PATH</span>                      日志文件路径
<span class="token constant">EXTENT_PATH</span>                   数据文件使用的簇大小（<span class="token number">16</span>），可选值：<span class="token number">16</span>，<span class="token number">32</span>，<span class="token number">64</span>，单位：页
<span class="token constant">PAGE_SIZE</span>                     数据页大小（<span class="token number">8</span>），可选值：<span class="token number">4</span>，<span class="token number">8</span>，<span class="token number">16</span>，<span class="token number">32</span>，单位：<span class="token class-name">K</span>
<span class="token constant">CASE_SENSITIVE</span>                大小敏感（<span class="token class-name">Y</span>），可选值：<span class="token class-name">Y</span><span class="token operator">/</span><span class="token class-name">N</span>，<span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token constant">CHARSET</span><span class="token operator">/</span><span class="token constant">UNICODE_FLAG</span>          字符集（<span class="token number">0</span>），可选值：<span class="token number">0</span><span class="token punctuation">[</span><span class="token constant">GB18030</span><span class="token punctuation">]</span>，<span class="token number">1</span><span class="token punctuation">[</span><span class="token constant">UTF</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span>，<span class="token number">2</span><span class="token punctuation">[</span><span class="token constant">EUC</span><span class="token operator">-</span><span class="token constant">KR</span><span class="token punctuation">]</span>
<span class="token constant">SEC_PRIV_MODE</span>                 权限管理模式（<span class="token number">0</span>），可选值：<span class="token number">0</span><span class="token punctuation">[</span><span class="token constant">TRADITION</span><span class="token punctuation">]</span>，<span class="token number">1</span><span class="token punctuation">[</span><span class="token constant">BMJ</span><span class="token punctuation">]</span>，<span class="token number">2</span><span class="token punctuation">[</span><span class="token constant">EVAL</span><span class="token punctuation">]</span>
<span class="token constant">LENGTH_IN_CHAR</span>                <span class="token constant">VARCHAR</span>类型长度是否以字符为单位（<span class="token class-name">N</span>），可选值：<span class="token class-name">Y</span><span class="token operator">/</span><span class="token class-name">N</span>，<span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span>
<span class="token constant">SYSDBA_PWD</span>                    设置<span class="token constant">SYSDBA</span>密码（<span class="token constant">SYSDBA</span>）
<span class="token constant">SYSAUDITOR_PWD</span>                设置<span class="token constant">SYSAUDITOR</span>密码（<span class="token constant">SYSAUDITOR</span>）
<span class="token constant">DB_NAME</span>                       数据库名（<span class="token constant">DBNAME</span>）
<span class="token constant">INSTANCE_NAME</span>                 实例名（<span class="token constant">DMSERVER</span>）    
<span class="token constant">PORT_NUM</span>                      监听端口号（<span class="token number">5236</span>）
<span class="token constant">BUFFER</span>                        系统缓存大小（<span class="token number">100</span>），单位<span class="token class-name">M</span>
<span class="token constant">TIME_ZONE</span>                     设置时区（<span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>）

<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/dminit path<span class="token operator">=</span><span class="token operator">/</span>dm8<span class="token operator">/</span>data db_name<span class="token operator">=</span><span class="token class-name">DMTEST</span> instance_NAME<span class="token operator">=</span><span class="token class-name">DMTESTSVR</span> sysdba_pwd<span class="token operator">=</span><span class="token class-name">Dameng123</span> port_num<span class="token operator">=</span><span class="token number">5238</span> <span class="token constant">PAGE_SIZE</span><span class="token operator">=</span><span class="token number">16</span>
initdb <span class="token constant">V8</span>
db version<span class="token operator">:</span> <span class="token number">0x7000c</span>
file dm<span class="token punctuation">.</span>key not found<span class="token punctuation">,</span> use <span class="token keyword">default</span> license<span class="token operator">!</span>
<span class="token class-name">License</span> will expire on <span class="token number">2022</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
log file path<span class="token operator">:</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span><span class="token constant">DMTEST01</span><span class="token punctuation">.</span>log
log file path<span class="token operator">:</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span><span class="token constant">DMTEST02</span><span class="token punctuation">.</span>log
write <span class="token keyword">to</span> <span class="token namespace">dir</span> <span class="token punctuation">[</span><span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token punctuation">]</span><span class="token punctuation">.</span>
create dm database success<span class="token punctuation">.</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">56</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>dminit 方式创建数据库不会自动注册数据库服务（DM 数据库配置助手方式默认自动注册数
据库服务），所以不能以服务方式启动数据库，如果要以服务方式启动，则需要注册数据库
服务。</p>
<h2 id="两种方式注册数据库服务" tabindex="-1"><a class="header-anchor" href="#两种方式注册数据库服务" aria-hidden="true">#</a> 两种方式注册数据库服务：</h2>
<p>（3.1）DM 数据库配置助手注册数据库服务
执行 <a href="http://dbca.sh" target="_blank" rel="noopener noreferrer">dbca.sh<ExternalLinkIcon/></a> 打开 DM 数据库配置助手，选择“注册数据库服务”
界面提示使用 root 用户执行脚本：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span># systemctl enable <span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service
<span class="token class-name">Created</span> symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span><span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service →
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span><span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span># systemctl start <span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/disql sysdba<span class="token operator">/</span><span class="token class-name">Dameng123</span><span class="token operator">:</span><span class="token number">5238</span>
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5238</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">12.</span><span class="token function">397</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> select name from v\$database<span class="token punctuation">;</span>
行号 <span class="token constant">NAME</span> 
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token constant">DMTEST</span>
已用时间<span class="token operator">:</span> <span class="token number">8.</span><span class="token function">418</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">50600.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select instance_name from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">INSTANCE_NAME</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">DMTESTSVR</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">563</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">50601.</span>
<span class="token constant">SQL</span><span class="token operator">></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3.2）root 执行注册服务脚本</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA04</span> <span class="token operator">~</span><span class="token punctuation">]</span># cd $<span class="token constant">DM_HOME</span><span class="token operator">/</span>script<span class="token operator">/</span>root
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA03</span> root<span class="token punctuation">]</span># <span class="token punctuation">.</span>/dm_service_installer<span class="token punctuation">.</span>sh <span class="token operator">-</span>t dmserver <span class="token operator">-</span>p <span class="token constant">DMTESTSVR</span> <span class="token operator">-</span>dm_ini <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini
<span class="token class-name">Created</span> symlink <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target<span class="token punctuation">.</span>wants<span class="token operator">/</span><span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service →
<span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span><span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span>
创建服务<span class="token punctuation">(</span><span class="token class-name">DmServiceDMTESTSVR</span><span class="token punctuation">)</span>完成
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="三-连接及操作数据库" tabindex="-1"><a class="header-anchor" href="#三-连接及操作数据库" aria-hidden="true">#</a> 三 连接及操作数据库</h1>
<h2 id="_1-连接数据库" tabindex="-1"><a class="header-anchor" href="#_1-连接数据库" aria-hidden="true">#</a> 1 连接数据库</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>如果使用客户端工具连接远端数据库服务器，需要开放数据库服务器防火墙对应端口（开放
端口后需 reload）：
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span># firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>add<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">5236</span><span class="token operator">/</span>tcp <span class="token operator">--</span>permanent <span class="token operator">--</span>zone<span class="token operator">=</span><span class="token keyword">public</span>
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span># firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>reload
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span># firewall<span class="token operator">-</span>cmd <span class="token operator">--</span>list<span class="token operator">-</span>ports
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以关闭数据库服务器的防火墙</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> dm<span class="token punctuation">]</span># systemctl status firewalld
<span class="token punctuation">[</span>root<span class="token annotation punctuation">@localhost</span> dm<span class="token punctuation">]</span># systemctl stop firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方式一-dm-管理工具图形化界面连接数据库" tabindex="-1"><a class="header-anchor" href="#方式一-dm-管理工具图形化界面连接数据库" aria-hidden="true">#</a> 方式一 DM 管理工具图形化界面连接数据库</h3>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd $<span class="token constant">DM_HOME</span><span class="token operator">/</span>tool
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="方式二-disql-命令行方式连接数据库" tabindex="-1"><a class="header-anchor" href="#方式二-disql-命令行方式连接数据库" aria-hidden="true">#</a> 方式二 disql 命令行方式连接数据库</h3>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>dm8<span class="token operator">/</span>bin
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/disql sysdba<span class="token operator">/</span><span class="token class-name">Dameng123</span><span class="token operator">:</span><span class="token number">5236</span>
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">1.</span><span class="token function">829</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> select name from v\$database<span class="token punctuation">;</span>
行号 <span class="token constant">NAME</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token constant">DM</span>
已用时间<span class="token operator">:</span> <span class="token number">2.</span><span class="token function">913</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">51600.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select instance_name from v\$instance<span class="token punctuation">;</span>
<span class="token number">26</span> <span class="token operator">/</span> <span class="token number">118</span>
行号 <span class="token constant">INSTANCE_NAME</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">DMSERVER</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">434</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">51601.</span>
<span class="token constant">SQL</span><span class="token operator">></span> exit
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/disql sysdba<span class="token operator">/</span><span class="token class-name">Dameng123</span><span class="token operator">:</span><span class="token number">5238</span>
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5238</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">12.</span><span class="token function">397</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> select name from v\$database<span class="token punctuation">;</span>
行号 <span class="token constant">NAME</span> 
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token constant">DMTEST</span>
已用时间<span class="token operator">:</span> <span class="token number">8.</span><span class="token function">418</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">50600.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select instance_name from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">INSTANCE_NAME</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">DMTESTSVR</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">563</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">50601.</span>
<span class="token constant">SQL</span><span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="网络配置助手配置连接串" tabindex="-1"><a class="header-anchor" href="#网络配置助手配置连接串" aria-hidden="true">#</a> 网络配置助手配置连接串</h3>
<p>网络配置助手</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA04</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/nca<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>网络配置助手实际写的是 dm_svc.conf 文件，也可以直接手工编辑该文件。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ cat <span class="token operator">/</span>etc<span class="token operator">/</span>dm_svc<span class="token punctuation">.</span>conf
<span class="token constant">TIME_ZONE</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">)</span>
<span class="token constant">LANGUAGE</span><span class="token operator">=</span><span class="token punctuation">(</span>cn<span class="token punctuation">)</span>
<span class="token constant">DM</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">)</span>
<span class="token constant">DMTEST</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">5238</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dm-数据库" tabindex="-1"><a class="header-anchor" href="#dm-数据库" aria-hidden="true">#</a> DM 数据库</h3>
<p>DM 数据库启动顺序：读取配置参数文件 dm.ini,找到控制文件 dm.ctl，启动后台进程和线程，启动数据库实例，启动到mount 状态，根据控制文件中的数据文件路径和练级日志文件路径，找到并打开数据文件和联机日志，启动到 OPEN 状态。
Oracle 启动顺序：nomount-&gt;mount-&gt;open
Shutdown：关闭状态
Mount：配置状态，此时可以修改数据库归档配置 主备等模式，不能进行数据文件的读写。此时数据库不能对外正常提供务。
Open：打开状态，此时数据库提供正常的服务。可以读写数据文件。正常访问表，读取数据。
Suspend：只读状态，只能读，不能写（DML 操作一旦 commit，数据库即会被挂起）。
MOUNT 和 OPEN 可以相互转换（与 Oracle 不同）。SUSPEND 和 OPEN 也可以相互转换。
但 MOUNT 和 SUSPEND 之间不能相互转换。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">SQL</span><span class="token operator">></span> select status$ from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">OPEN</span>
已用时间<span class="token operator">:</span> <span class="token number">4.</span><span class="token function">453</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">52100.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database mount<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">371.</span><span class="token function">497</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select status$ from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">MOUNT</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">599</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">52101.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database <span class="token keyword">open</span><span class="token punctuation">;</span>
<span class="token number">29</span> <span class="token operator">/</span> <span class="token number">118</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">333.</span><span class="token function">412</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select status$ from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">OPEN</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">463</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">52102.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database suspend<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">102.</span><span class="token function">752</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select status$ from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">SUSPEND</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">514</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">52103.</span>
<span class="token constant">SQL</span><span class="token operator">></span> exit
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>MOUNT 状态下，可以配置归档，设置主备模式，修改联机日志文件路径等，MOUNT 状态下不能读写数据（但可以读动态性能视图中的数据，因为动态视图数据来源于控制文件或内存中的，比如 v$datafile v$database 等），MOUNT 状态数据库不能对外提供服务（不能读写数据，业务中断）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ disql sysdba<span class="token operator">/</span><span class="token constant">SYSDBA</span><span class="token annotation punctuation">@OA</span>
服务器<span class="token punctuation">[</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">1.</span><span class="token function">744</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database mount<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">9.</span><span class="token function">672</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select <span class="token operator">*</span> from t_test<span class="token punctuation">;</span>
select <span class="token operator">*</span> from t_test<span class="token punctuation">;</span>
第 <span class="token number">1</span> 行附近出现错误<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">510</span><span class="token punctuation">]</span><span class="token operator">:</span>系统处于 <span class="token constant">MOUNT</span> 状态<span class="token punctuation">.</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">587</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> insert into <span class="token function">t_test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into <span class="token function">t_test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">510</span><span class="token punctuation">]</span><span class="token operator">:</span>系统处于 <span class="token constant">MOUNT</span> 状态<span class="token punctuation">.</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">403</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select name<span class="token punctuation">,</span> status$ from v\$instance<span class="token punctuation">;</span>
行号 <span class="token constant">NAME</span> <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">DMOASERVER</span> <span class="token constant">MOUNT</span>
已用时间<span class="token operator">:</span> <span class="token number">3.</span><span class="token function">317</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">2700.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select name<span class="token punctuation">,</span> status$ from v\$database<span class="token punctuation">;</span>
行号 <span class="token constant">NAME</span> <span class="token constant">STATUS</span>$
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token constant">DMOA</span> <span class="token number">3</span>
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">347</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">2701.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select path from v\$datafile<span class="token punctuation">;</span>
行号 <span class="token constant">PATH</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMOA</span><span class="token operator">/</span><span class="token constant">SYSTEM</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
<span class="token number">2</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMOA</span><span class="token operator">/</span><span class="token constant">ROLL</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
<span class="token number">3</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMOA</span><span class="token operator">/</span><span class="token constant">TEMP</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
<span class="token number">4</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMOA</span><span class="token operator">/</span><span class="token constant">MAIN</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
<span class="token number">5</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMOA</span><span class="token operator">/</span><span class="token constant">DMHR</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="三-dm-数据库启动方式" tabindex="-1"><a class="header-anchor" href="#三-dm-数据库启动方式" aria-hidden="true">#</a> 三 DM 数据库启动方式：</h1>
<h2 id="root-启动" tabindex="-1"><a class="header-anchor" href="#root-启动" aria-hidden="true">#</a> Root 启动：</h2>
<p>（1） systemctl 服务方式管理（CentOS6 使用 service 命令）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>systemctl start<span class="token operator">|</span>status<span class="token operator">|</span>stop<span class="token operator">|</span>enable<span class="token operator">|</span>disable <span class="token class-name">DmServiceDMSERVER</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>（2） DM 服务查看器管理（以 root 方式打开才有启动的权限）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>root<span class="token annotation punctuation">@KylinDCA04</span> tool<span class="token punctuation">]</span># <span class="token punctuation">.</span>/dmservice<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="dmdba-用户启动" tabindex="-1"><a class="header-anchor" href="#dmdba-用户启动" aria-hidden="true">#</a> dmdba 用户启动</h2>
<p>两种启动方式，都可以将数据库启动到 mount 状态）：
（1） 前台启动方式（dmserver）
如果没有注册数据库服务，只能使用此方式启动。其他的启动方式都需要注册数据库服务。
前台启动方式，界面输入 exit 或者按 CTRL+C 即会关闭数据库；</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/dmserver <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini
file dm<span class="token punctuation">.</span>key not found<span class="token punctuation">,</span> use <span class="token keyword">default</span> license<span class="token operator">!</span>
version info<span class="token operator">:</span> develop
<span class="token constant">DM</span> <span class="token class-name">Database</span> <span class="token class-name">Server</span> x64 <span class="token constant">V8</span> <span class="token number">4</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">18</span><span class="token operator">-</span><span class="token number">21.08</span><span class="token number">.20</span><span class="token operator">-</span><span class="token number">146029</span><span class="token operator">-</span><span class="token number">10013</span><span class="token operator">-</span><span class="token constant">ENT</span> startup<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">License</span> will expire on <span class="token number">2022</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span>
file lsn<span class="token operator">:</span> <span class="token number">28292</span>
ndct db load finished
ndct fill fast pool finished
iid page's trxid<span class="token punctuation">[</span><span class="token number">6012</span><span class="token punctuation">]</span>
<span class="token constant">NEXT</span> <span class="token class-name">TRX</span> <span class="token constant">ID</span> <span class="token operator">=</span> <span class="token number">6013</span>
pseg_collect_mgr_items<span class="token punctuation">,</span> total collect <span class="token number">0</span> active_trxs<span class="token punctuation">,</span> <span class="token number">0</span> cmt_trxs<span class="token punctuation">,</span> <span class="token number">0</span> pre_cmt_trxs<span class="token punctuation">,</span> <span class="token number">0</span> active_pages<span class="token punctuation">,</span> <span class="token number">0</span> 
cmt_pages<span class="token punctuation">,</span> <span class="token number">0</span> pre_cmt_pages<span class="token punctuation">,</span> <span class="token number">0</span> mgr pages<span class="token punctuation">,</span> <span class="token number">0</span> mgr recs<span class="token operator">!</span>
total <span class="token number">0</span> active crash trx<span class="token punctuation">,</span> pseg_crash_trx_rollback <span class="token function">sys_only</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> begin <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
pseg_crash_trx_rollback end<span class="token punctuation">,</span> total <span class="token number">0</span> active crash trx<span class="token punctuation">,</span> include <span class="token number">0</span> empty_trxs<span class="token punctuation">,</span> <span class="token number">0</span> empty_pages which 
only need <span class="token keyword">to</span> <span class="token namespace">delete</span> mgr recs<span class="token punctuation">.</span>
pseg_crash_trx_rollback end
pseg recv finished
nsvr_startup end<span class="token punctuation">.</span>
aud sys init success<span class="token punctuation">.</span>
aud rt sys init success<span class="token punctuation">.</span>
systables desc init success<span class="token punctuation">.</span>
ndct_db_load_info success<span class="token punctuation">.</span>
nsvr_process_before_open begin<span class="token punctuation">.</span>
nsvr_process_before_open success<span class="token punctuation">.</span>
total <span class="token number">0</span> active crash trx<span class="token punctuation">,</span> pseg_crash_trx_rollback <span class="token function">sys_only</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> begin <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
pseg_crash_trx_rollback end<span class="token punctuation">,</span> total <span class="token number">0</span> active crash trx<span class="token punctuation">,</span> include <span class="token number">0</span> empty_trxs<span class="token punctuation">,</span> <span class="token number">0</span> empty_pages which 
only need <span class="token keyword">to</span> <span class="token namespace">delete</span> mgr recs<span class="token punctuation">.</span>
pseg_crash_trx_rollback end
<span class="token constant">SYSTEM</span> <span class="token constant">IS</span> <span class="token constant">READY</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）后台启动方式（DmServiceDMSERVER）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ cd <span class="token operator">/</span>dm8<span class="token operator">/</span>bin
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ ll <span class="token class-name">Dm</span><span class="token operator">*</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">13827</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">33</span> <span class="token class-name">DmAPService</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">14850</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">33</span> <span class="token class-name">DmAuditMonitorService</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">13655</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">33</span> <span class="token class-name">DmInstanceMonitorService</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">14110</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">33</span> <span class="token class-name">DmJobMonitorService</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">16117</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">53</span> <span class="token class-name">DmServiceDMSERVER</span>
<span class="token operator">-</span>rwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x <span class="token number">1</span> dmdba dinstall <span class="token number">16122</span> <span class="token number">12</span> 月 <span class="token number">20</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">56</span> <span class="token class-name">DmServiceDMTESTSVR</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DmServiceDMTESTSVR</span> start
<span class="token class-name">Starting</span> <span class="token class-name">DmServiceDMTESTSVR</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token constant">OK</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DmServiceDMTESTSVR</span> stop
<span class="token class-name">Stopping</span> <span class="token class-name">DmServiceDMTESTSVR</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token constant">OK</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DmServiceDMTESTSVR</span> start mount
<span class="token class-name">Starting</span> <span class="token class-name">DmServiceDMTESTSVR</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token constant">OK</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/<span class="token class-name">DmServiceDMTESTSVR</span> status
<span class="token class-name">DmServiceDMTESTSVR</span> <span class="token punctuation">(</span>pid <span class="token number">35387</span><span class="token punctuation">)</span> is running<span class="token punctuation">.</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> bin<span class="token punctuation">]</span>$
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="四-dm-的客户端工具" tabindex="-1"><a class="header-anchor" href="#四-dm-的客户端工具" aria-hidden="true">#</a> 四 DM 的客户端工具</h1>
<h2 id="dm-管理工具-manager" tabindex="-1"><a class="header-anchor" href="#dm-管理工具-manager" aria-hidden="true">#</a> DM 管理工具（manager）</h2>
<p>图形化管理数据库，联机工具，包含用户管理 角色权限管理 表空间 模式 模式下对象（表 索引 约束 函数 过程 视图等) 数据库物理联机备份 作业管理等功能</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="dm-控制台工具-console" tabindex="-1"><a class="header-anchor" href="#dm-控制台工具-console" aria-hidden="true">#</a> DM 控制台工具（console）</h2>
<p>DM 控制台工具是一个脱机工具，提供脱机备份还原 修改数据库参数（修改后重启数据库才能生效）等功能。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/console
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="dm-数据迁移工具-dts" tabindex="-1"><a class="header-anchor" href="#dm-数据迁移工具-dts" aria-hidden="true">#</a> DM 数据迁移工具（dts）</h2>
<p>DM 数据迁移工具支持其他数据库迁移到达梦，或者达梦迁移到文件等功能。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/dts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="dm-性能监视工具-monitor" tabindex="-1"><a class="header-anchor" href="#dm-性能监视工具-monitor" aria-hidden="true">#</a> DM 性能监视工具（monitor）：</h2>
<p>可以用来监视数据库的线程 事务会话 表空间占用等信息。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> tool<span class="token punctuation">]</span>$ <span class="token punctuation">.</span>/monitor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="五-dm体系结构" tabindex="-1"><a class="header-anchor" href="#五-dm体系结构" aria-hidden="true">#</a> 五 DM体系结构</h1>
<h2 id="dm8-数据库是由数据库和实例构成" tabindex="-1"><a class="header-anchor" href="#dm8-数据库是由数据库和实例构成" aria-hidden="true">#</a> DM8 数据库是由数据库和实例构成</h2>
<h3 id="数据库" tabindex="-1"><a class="header-anchor" href="#数据库" aria-hidden="true">#</a> 数据库：</h3>
<p>DM 数据库指的是磁盘上存放在 DM 数据库中的数据的集合</p>
<h3 id="实例" tabindex="-1"><a class="header-anchor" href="#实例" aria-hidden="true">#</a> 实例：</h3>
<p>实例一般是由一组正在运行的 DM 后台进程/线程以及一个大型的共享内存组成
<img src="/assets/images/dm1.png" alt="img" loading="lazy"></p>
<h2 id="dm-存储结构" tabindex="-1"><a class="header-anchor" href="#dm-存储结构" aria-hidden="true">#</a> DM 存储结构</h2>
<p><img src="/assets/images/dm2.png" alt="img" loading="lazy">
表空间是 DM 数据库的最大存储单元，所有数据都存储在表空间中。
表空间采用段（segment） 簇（extent）和页（page，对应 block）的方式管理。
一个表空间可以包含一个或多个数据文件。一个数据文件仅能归属于一个表空间。
DM 物理文件包含：配置文件 控制文件 数据文件 联机日志（此四个文件必不可少，缺少一个将无法正常启动）。
配置文件包括（服务配置 dm.ini，守护配置，复制配置，审计配置）
控制文件，数据文件，重做日志文件，备份文件，归档日志文件，跟踪日志文件等
<img src="/assets/images/dm3.png" alt="img" loading="lazy"></p>
<h2 id="dm-数据库参数的类型" tabindex="-1"><a class="header-anchor" href="#dm-数据库参数的类型" aria-hidden="true">#</a> DM 数据库参数的类型：</h2>
<p>READ ONLY：手动参数，不能通过 SQL 命令或函数修改；只能通过修改 dm.ini 文本文件修改此参数（需要重启数据库才能生效）。
SYS：动态（系统级）参数。数据库运行中可以直接修改，可以即可以修改内存中的值，也可以修改参数文件中的值。可以通过 SQL 命令或系统函数修改。
SESSION:动态（会话级）参数，数据库运行中可以直接修改，可以即可以修改内存中的值，也可以修改参数文件中的值，还可以只修改当前会话的值。可以通过 SQL 命令或函数修改，且可以只针对当前会话生效。
IN FILE：静态参数，不能修改内存中的值，只能修改参数文件中的值，可以通过 SQL 命令或函数修改，但需要重启数据库才能生效。
静态参数在数据库运行期间不能修改内存中的值，动态参数在数据库运行期间可以修改内存中的值（修改后立即生效）。</p>
<h2 id="运行时的内存池" tabindex="-1"><a class="header-anchor" href="#运行时的内存池" aria-hidden="true">#</a> 运行时的内存池：</h2>
<p>特点：使用时申请，用完即释放。包含：虚拟内存池 vm pool 会话池 session pool
排序区 HASH 区等。
排序区和 HASH 区
排序区：SORT_BUF_SIZE
少量的数据排序，优先在内存中排序，此时占用排序区；
大量的数据排序，内存中放不下，占用临时表空间排序。
如果业务经常有排序，可以适当调大排序区，提高效率。
HASH 区：HJ_BUF_SIZE
HASH 连接 HASH 分区占用哈希区。如果业务 hash 连接较多，可以调大哈希区。</p>
<h2 id="dm-线程" tabindex="-1"><a class="header-anchor" href="#dm-线程" aria-hidden="true">#</a> DM 线程</h2>
<p>DM 是单进程多线程对称服务器架构。Oracle 是多进程架构。</p>
<h3 id="监听线程" tabindex="-1"><a class="header-anchor" href="#监听线程" aria-hidden="true">#</a> 监听线程</h3>
<p>用于在服务器端口上进行循环监听，有来自客户的连接请求，监听线程被唤醒并生成一个会话线程，将申请的任务加入工作线程的任务队列，等待工作线程进行处理。 会话线程 dm_sql_thd 每个会话 session 对应一个会话线程，会话多时该线程会多，会话对应的线程 id 可以在 v$sessions 中查询。</p>
<h3 id="工作线程" tabindex="-1"><a class="header-anchor" href="#工作线程" aria-hidden="true">#</a> 工作线程</h3>
<p>DM 的核心线程；默认 16 个工作线程。</p>
<h3 id="io-线程" tabindex="-1"><a class="header-anchor" href="#io-线程" aria-hidden="true">#</a> IO 线程</h3>
<p>用于读写数据
需要处理的数据块不在缓冲区中，此时需要将相关数据块读入缓冲区 -物理读
缓冲区满或系统关闭时，此时需要将部分脏数据块写入磁盘 -写脏块
检查点到来时，需要将所有脏数据块写入磁盘</p>
<h3 id="日志刷新线程" tabindex="-1"><a class="header-anchor" href="#日志刷新线程" aria-hidden="true">#</a> 日志刷新线程</h3>
<p>日志的刷盘。主要用于事务提交或检查点时将日志缓冲区中的 REDO 日志写入到日志文
件中。</p>
<h3 id="日志归档线程" tabindex="-1"><a class="header-anchor" href="#日志归档线程" aria-hidden="true">#</a> 日志归档线程</h3>
<p>完成 redo 日志的归档。</p>
<h3 id="日志重做线程" tabindex="-1"><a class="header-anchor" href="#日志重做线程" aria-hidden="true">#</a> 日志重做线程</h3>
<p>主要用于系统故障恢复，日志重做线程根据 REDO 日志进行并行的故障恢复</p>
<h3 id="调度线程" tabindex="-1"><a class="header-anchor" href="#调度线程" aria-hidden="true">#</a> 调度线程</h3>
<p>用于定时调度任务。
检查系统级的时间触发器；
清理 SQL 缓存 计划缓存中失效的项，或者超出缓存限制后淘汰不常用的缓存项；
动态缓冲区检查。根据需要动态扩展或动态收缩系统缓冲池；
自动执行检查点;
会话超时检测;
必要时执行数据更新页刷盘；
唤醒等待的工作线程;</p>
<h1 id="六-一个-sql-的执行" tabindex="-1"><a class="header-anchor" href="#六-一个-sql-的执行" aria-hidden="true">#</a> 六 一个 sql 的执行</h1>
<p>当客户端发起请求，首先到达监听线程，监听线程创建一个会话线程，将任务加入工作线程队列。
Sql 语法语义权限解析（字典缓冲区，语法语义校验，权限校验）：
首先在 sql 缓冲区中查找是否有对应的 sql 语句，如果找到，再查找对应的执行计划，找到执行计划，根据执行计划执行 sql，这个过程称为软解析；如果 sql 缓冲区中没有找到对应 sql 语句，会将该sql 语句加入 sql 缓冲区，并生成对应执行计划，执行计划放入 sql 缓冲区，根据执行计划执行 sql 语句，返回结果集，这个过程称为硬解析）。
从系统性能提升来说，要减少硬解析。查询（读数据，数据缓冲区，如果数据缓冲区中存在数据页，则直接从数据缓冲区中读取数据，称为逻辑读；如果数据缓冲区中不存在该数据页，会话线程调用 IO 线程，IO 线程从磁盘上的数据文件中读取数据页并放入到数据缓冲区，称为物理读。
从系统性能考虑，应减少物理读，提高逻辑读）,如果查询涉及 HASH 连接等，会占用 HASH 区，如果涉及到排序，少量的数据排序（内存中能排下的）则占用排序区，HASH 区和排序区以会话池或虚拟池的方式申请。
修改（将数据读入数据缓冲区，此过程同上，在数据缓冲区中修改，修改会产生 redo 和 undo，redo 放在日志缓冲区中，undo 写入回滚段； 修改完成后，执行 commit，日志刷新线程将日志缓冲区中的数据写入联机日志文件；当数据库执行检查点时，IO 线程会将脏页写入磁盘数据文件。</p>
<h1 id="七-表空间管理" tabindex="-1"><a class="header-anchor" href="#七-表空间管理" aria-hidden="true">#</a> 七 表空间管理</h1>
<h2 id="管理表空间" tabindex="-1"><a class="header-anchor" href="#管理表空间" aria-hidden="true">#</a> 管理表空间</h2>
<p>表空间是 DM 数据库的最大逻辑存储单元，表中的数据在逻辑上都是存放在表空间中，在物理上存放在表空间对应的物理数据文件。表空间由数据文件组成，表空间采用段 簇 页的方式进行管理。
DM 默认预定义 SYSTEM ROLL MAIN TEMP HMAIN 五个表空间。
SYSTEM：系统表空间，存放数据字典等信息（表 字段 视图等对象的定义 用户角色权限信息等，部分隐含参数写入SYSTEM 表空间），SYSTEM 表空间自动扩展不允许关闭。
ROLL：回滚表空间，存放回滚页，数据库中的 DML 操作对应都会生成 redo 和 undo，undo 信息放入 ROLL 表空间对应的数据文件中，redo 信息写入联机日志文件，用于保证数据的一致性。
ROLL 回滚段数据包含 Active unexpired expired 三种状态。
遇到查询记录过旧的错误（等同于 oracle 的快照过旧的错误）。解决方法：
1  增大 undo_retention（回滚段的保留时长）, 及时 分段提交。扩大 ROLL 表空间。
2 查询时间过长导致，可以考虑优化查询。
MAIN：用户默认表空间，当创建用户时，如果为指定用户的默认表空间，则 MAIN 为用户的默认表空间。相当于 Oracle 的 USERS 表空间。
TEMP：临时表空间，存放临时表数据 临时结果集等，当大量的数据排序或创建索引等占用临时表空间。DM 中临时表空间由参数 TEMP_SIZE 指定。</p>
<h2 id="修改tmp表空间" tabindex="-1"><a class="header-anchor" href="#修改tmp表空间" aria-hidden="true">#</a> 修改TMP表空间</h2>
<p>数据库启动时会按照如下参数重建 TEMP 表空间。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> type from v\$parameter t where name like <span class="token char">'TEMP%'</span><span class="token punctuation">;</span>
# <span class="token constant">TEMP_SIZE</span>：临时表空间初始大小
# <span class="token constant">TEMP_PATH</span><span class="token operator">:</span> 临时表空间路径
# <span class="token constant">TEMP_SPACE_LIMIT</span>：临时表空间的空间限制，<span class="token number">0</span> 表示不限制。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改临时表空间的初始大小：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code># alter system set '<span class="token constant">TEMP_SIZE</span>'<span class="token operator">=</span><span class="token number">100</span> spfile<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>收缩 TEMP 表空间的方法：
1  重启数据库，TEMP 表空间数据文件会重建。
2  在线收缩临时表空间使用 SP_TRUNC_TS_FILE 函数。</p>
<h2 id="创建表空间" tabindex="-1"><a class="header-anchor" href="#创建表空间" aria-hidden="true">#</a> 创建表空间</h2>
<p>使用 create tablespace 语句创建表空间：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>create tablespace tbs <span class="token constant">DATAFILE</span> '<span class="token constant">TBS01</span><span class="token punctuation">.</span><span class="token constant">DBF</span>' size <span class="token number">32</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>DM 数据文件大小，最大值不能低于页大小的 4096 倍（如果页大小是 8K，最小值将不
低于 32M），最大值为页大小的 2 的 31 次方-1（如果页大小是 8K，最大值为 16T-1）。</p>
<h2 id="表空间重命名" tabindex="-1"><a class="header-anchor" href="#表空间重命名" aria-hidden="true">#</a> 表空间重命名</h2>
<p>DM 预定义表空间不支持重命名，自定义表空间支持重命名。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter tablespace tbs <span class="token constant">RENAME</span> <span class="token class-name">TO</span> dmtbs<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="八-归档管理" tabindex="-1"><a class="header-anchor" href="#八-归档管理" aria-hidden="true">#</a> 八 归档管理</h1>
<h2 id="归档管理" tabindex="-1"><a class="header-anchor" href="#归档管理" aria-hidden="true">#</a> 归档管理</h2>
<p>默认情况下，达梦数据库运行在非归档模式下。
归档是对 REDO 日志的归档。归档的目的是使数据库故障时可以恢复到故障的前一刻（完
全恢复），或者恢复到指定的时间点或指定 LSN（Log Sequence Number）（不完全恢复）。
假如现网每天凌晨 0 点备份；
第二天下午 14：00 数据磁盘损坏，数据库故障。
故障时联机日志中只有 13：30-14：00；此时如果没有开启数据库归档，则数据库无法恢复
到故障前一刻 14：00（缺失凌晨 0 点-13：30 的 redo 信息）。
开归档就可以将凌晨 0 点-14：00 的 redo 信息保存在归档日志文件中，数据库恢复时就可以
利用归档将数据库恢复到最新的状态。
联机备份，数据库需要开启归档状态。
利用归档可以做完全恢复和不完全恢复。</p>
<h2 id="sql-开启归档" tabindex="-1"><a class="header-anchor" href="#sql-开启归档" aria-hidden="true">#</a> SQL 开启归档</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>归档开启：
alter database mount<span class="token punctuation">;</span>
alter database <span class="token constant">ARCHIVELOG</span><span class="token punctuation">;</span>
alter database <span class="token constant">ADD</span> <span class="token constant">ARCHIVELOG</span> 'type<span class="token operator">=</span>local<span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token operator">/</span>dm8<span class="token operator">/</span>arch<span class="token punctuation">,</span> file_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> 
space_limit<span class="token operator">=</span><span class="token number">10240</span>'<span class="token punctuation">;</span>
alter database <span class="token keyword">open</span><span class="token punctuation">;</span>
查看归档配置：
select arch_mode from v\$database<span class="token punctuation">;</span>
select <span class="token operator">*</span> from v\$dm_arch_ini<span class="token punctuation">;</span>
修改归档的配置（修改归档空间上限）：
alter database modify archivelog 'type<span class="token operator">=</span>local<span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token operator">/</span>dm8<span class="token operator">/</span>arch<span class="token punctuation">,</span> <span class="token constant">SPACE_LIMIT</span><span class="token operator">=</span><span class="token number">20480</span>'<span class="token punctuation">;</span>
<span class="token constant">SQL</span> 关闭归档
<span class="token constant">SQL</span><span class="token operator">></span> alter database mount<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">438.</span><span class="token function">355</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database noarchivelog<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">41.</span><span class="token function">445</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database delete archivelog 'type<span class="token operator">=</span>local<span class="token punctuation">,</span>dest<span class="token operator">=</span><span class="token operator">/</span>dm8<span class="token operator">/</span>arch'<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">519</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter database <span class="token keyword">open</span><span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">322.</span><span class="token function">559</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">0.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select arch_mode from v\$database<span class="token punctuation">;</span>
行号 <span class="token constant">ARCH_MODE</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token number">1</span> <span class="token class-name">N</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">654</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">714.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select <span class="token operator">*</span> from v\$dm_arch_ini<span class="token punctuation">;</span>
未选定行
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改-dm-ini-和-dmarch-ini-配置文件开启归档" tabindex="-1"><a class="header-anchor" href="#修改-dm-ini-和-dmarch-ini-配置文件开启归档" aria-hidden="true">#</a> 修改 dm.ini 和 dmarch.ini 配置文件开启归档</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token constant">DM</span><span class="token punctuation">]</span>$ cat dmarch<span class="token punctuation">.</span>ini
#<span class="token class-name">DaMeng</span> <span class="token class-name">Database</span> <span class="token class-name">Archive</span> <span class="token class-name">Configuration</span> file
#<span class="token keyword">this</span> is comments
 <span class="token constant">ARCH_WAIT_APPLY</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span><span class="token constant">ARCHIVE_LOCAL1</span><span class="token punctuation">]</span>
 <span class="token constant">ARCH_TYPE</span> <span class="token operator">=</span> <span class="token class-name">LOCAL</span>
 <span class="token constant">ARCH_DEST</span> <span class="token operator">=</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>arch
 <span class="token constant">ARCH_FILE_SIZE</span> <span class="token operator">=</span> <span class="token number">64</span>
 <span class="token constant">ARCH_SPACE_LIMIT</span> <span class="token operator">=</span> <span class="token number">10240</span>
 <span class="token constant">ARCH_FLUSH_BUF_SIZE</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token constant">DM</span><span class="token punctuation">]</span>$ cat dm<span class="token punctuation">.</span>ini<span class="token operator">|</span>grep <span class="token class-name">ARCH_INI</span>
 <span class="token constant">ARCH_INI</span> <span class="token operator">=</span> <span class="token number">1</span> #dmarch<span class="token punctuation">.</span>ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="归档日志文件的切换和删除" tabindex="-1"><a class="header-anchor" href="#归档日志文件的切换和删除" aria-hidden="true">#</a> 归档日志文件的切换和删除</h2>
<p>数据库自动完成归档的切换，DM 支持手工切换归档；</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter <span class="token constant">SYSTEM</span> <span class="token constant">ARCHIVE</span> <span class="token class-name">LOG</span> <span class="token constant">CURRENT</span><span class="token punctuation">;</span>
alter <span class="token constant">SYSTEM</span> <span class="token class-name">SWITCH</span> <span class="token constant">LOGFILE</span><span class="token punctuation">;</span>
alter <span class="token constant">DATABASE</span> <span class="token class-name">ARCHIVELOG</span> <span class="token constant">CURRENT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="归档文件的删除" tabindex="-1"><a class="header-anchor" href="#归档文件的删除" aria-hidden="true">#</a> 归档文件的删除</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from v\$ifun t where name like '<span class="token constant">SF_ARCHIVELOG_</span><span class="token operator">%</span>'<span class="token punctuation">;</span>
<span class="token constant">SF_ARCHIVELOG_DELETE_BEFORE_LSN</span>
<span class="token constant">SF_ARCHIVELOG_DELETE_BEFORE_TIME</span>
# 删除<span class="token number">10</span>天前的归档日志。
<span class="token class-name">Select</span> <span class="token function">SF_ARCHIVELOG_DELETE_BEFORE_TIME</span><span class="token punctuation">(</span>sysdate<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>针对业务繁忙期间，出现磁盘 IO 不定时繁忙的情况，因为配置了归档的空间上限（归档达
到此上限），生成新的归档日志前删除旧的归档日志文件造成了 IO 的不定时繁忙。
解决方案：配置 JOB 作业，在业务空间期定时清理 N 天之前的归档文件。</p>
<h1 id="九-用户管理" tabindex="-1"><a class="header-anchor" href="#九-用户管理" aria-hidden="true">#</a> 九 用户管理</h1>
<h2 id="用户类型" tabindex="-1"><a class="header-anchor" href="#用户类型" aria-hidden="true">#</a> 用户类型</h2>
<p>DM 默认的预定义用户：
SYS：系统内置用户，不允许登录。
SYSDBA：系统管理员，拥有几乎所有权限（除审计和强制访问控制）
SYSAUDITOR：系统审计管理员，具有审计相关权限。
SYSSSO：系统安全管理员，具有强制访问控制等权限；
SYSDBO：安全版本才有的用户，安全操作员。</p>
<h2 id="系统口令策略" tabindex="-1"><a class="header-anchor" href="#系统口令策略" aria-hidden="true">#</a> 系统口令策略</h2>
<p>PWD_POLICY（隐含参数，不在 dm.ini 中）参数指定系统的口令策略，默认为 2；
系统支持的口令策略有：
0 无策略
1 禁止与用户名相同
2 口令长度需大于等于 INI 参数 PWD_MIN_LEN 设置的值
4 至少包含一个大写字母（A-Z）
8 至少包含一个数字（0-9）
16 至少包含一个标点符号（英文输入法状态下，除“和空格外的所有符号）
口令策略可单独应用，也可组合应用。组合应用时，如需要应用策略 2 和 4，则设置口
令策略为 2+4=6 即可。
PWD_POLICY 是隐含参数，PWD_POLICY，只能通过函数或 SQL 语句修改。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from v\$parameter t where t<span class="token punctuation">.</span>name <span class="token operator">=</span> '<span class="token constant">PWD_POLICY</span>'<span class="token punctuation">;</span>
create user hr <span class="token constant">IDENTIFIED</span> by dameng123<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改系统口令策略" tabindex="-1"><a class="header-anchor" href="#修改系统口令策略" aria-hidden="true">#</a> 修改系统口令策略：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter <span class="token constant">SYSTEM</span> set '<span class="token constant">PWD_POLICY</span>' <span class="token operator">=</span> <span class="token number">15</span> <span class="token constant">BOTH</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="sql-管理用户" tabindex="-1"><a class="header-anchor" href="#sql-管理用户" aria-hidden="true">#</a> SQL 管理用户</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>create user hrtest <span class="token constant">IDENTIFIED</span> by dameng123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="用户输入错误多次-默认-3-次-将会被锁定。" tabindex="-1"><a class="header-anchor" href="#用户输入错误多次-默认-3-次-将会被锁定。" aria-hidden="true">#</a> 用户输入错误多次（默认 3 次），将会被锁定。</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from dba_users<span class="token punctuation">;</span>
select b<span class="token punctuation">.</span><span class="token constant">USERNAME</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>* from sysusers a<span class="token punctuation">,</span> dba_users b where a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token constant">USER_ID</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户" aria-hidden="true">#</a> 创建用户</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>create user hrtest <span class="token constant">IDENTIFIED</span> by <span class="token class-name">Dameng123</span> <span class="token constant">DEFAULT</span> <span class="token class-name">TABLESPACE</span> <span class="token constant">TBSTEST</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="用户锁定和解锁" tabindex="-1"><a class="header-anchor" href="#用户锁定和解锁" aria-hidden="true">#</a> 用户锁定和解锁：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter user hr <span class="token class-name">ACCOUNT</span> <span class="token constant">UNLOCK</span><span class="token punctuation">;</span>
alter user hr <span class="token class-name">ACCOUNT</span> <span class="token constant">LOCK</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改用户的默认表空间" tabindex="-1"><a class="header-anchor" href="#修改用户的默认表空间" aria-hidden="true">#</a> 修改用户的默认表空间：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter user hr <span class="token constant">DEFAULT</span> <span class="token class-name">TABLESPACE</span> dmtbs<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="修改用户密码" tabindex="-1"><a class="header-anchor" href="#修改用户密码" aria-hidden="true">#</a> 修改用户密码:</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter user hrtest <span class="token constant">IDENTIFIED</span> by <span class="token string">"Dameng@123"</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="删除用户" tabindex="-1"><a class="header-anchor" href="#删除用户" aria-hidden="true">#</a> 删除用户：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>drop user <span class="token keyword">if</span> <span class="token class-name">EXISTS</span> hr<span class="token punctuation">;</span>
drop user <span class="token keyword">if</span> <span class="token constant">EXISTS</span> hr <span class="token constant">CASCADE</span><span class="token punctuation">;</span> <span class="token operator">--</span>生产环境慎用
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="用户资源限制" tabindex="-1"><a class="header-anchor" href="#用户资源限制" aria-hidden="true">#</a> 用户资源限制</h2>
<p>用户资源限制设置（可以直接使用 limit 子句，也可以使用 profile 来管理用户的资源限制）：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>alter user hr <span class="token constant">LIMIT</span> <span class="token class-name">FAILED_LOGIN_ATTEMPS</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">PASSWORD_LOCK_TIME</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>DM 支持使用 profile 管理用户资源限制（新版本支持，2021 年 10 月以后的版本）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from <span class="token constant">DBA_PROFILES</span><span class="token punctuation">;</span>
create profile profile1 limit <span class="token class-name">FAILED_LOGIN_ATTEMPS</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">PASSWORD_LOCK_TIME</span> <span class="token number">3</span><span class="token punctuation">,</span> 
<span class="token class-name">PASSWORD_LIFE_TIME</span> <span class="token number">180</span><span class="token punctuation">;</span>
alter user hrtest <span class="token class-name">PROFILE</span> profile1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询用户使用的profile资源限制文件</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select a<span class="token punctuation">.</span>pid profileid<span class="token punctuation">,</span> b<span class="token punctuation">.</span>name profile_name<span class="token punctuation">,</span> a<span class="token punctuation">.</span>uid userid<span class="token punctuation">,</span> c<span class="token punctuation">.</span>name user_name
from <span class="token class-name">SYSUSERPROFILES</span> a<span class="token punctuation">,</span> <span class="token class-name">SYSOBJECTS</span> b<span class="token punctuation">,</span> <span class="token constant">SYSOBJECTS</span> c
where a<span class="token punctuation">.</span><span class="token constant">PID</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>id 
and a<span class="token punctuation">.</span><span class="token constant">UID</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token constant">ID</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>密码带有特殊字符的登录处理
达梦中密码带有特殊字符需要双引号括起来，在 linux 系统下可以使用单引号‘转义。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA03</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ disql hrtest<span class="token operator">/</span>'<span class="token string">"Dameng@123"</span>'
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">1.</span><span class="token function">589</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> conn hrtest<span class="token operator">/</span><span class="token string">"Dameng@123"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用右斜杠\转义</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ disql dmoa<span class="token operator">/</span>\"<span class="token class-name">Dameng</span><span class="token annotation punctuation">@123</span>\"
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">3.</span><span class="token function">162</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> alter user dmoa identified by <span class="token string">"Dameng123@#'"</span><span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">6.</span><span class="token function">184</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1000.</span>
<span class="token constant">SQL</span><span class="token operator">></span> exit
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@localhost</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ disql dmoa<span class="token operator">/</span>\"<span class="token class-name">Dameng123</span>@#\'\"
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">1.</span><span class="token function">863</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="十-权限管理" tabindex="-1"><a class="header-anchor" href="#十-权限管理" aria-hidden="true">#</a> 十 权限管理</h1>
<h2 id="赋予数据库权限-系统权限" tabindex="-1"><a class="header-anchor" href="#赋予数据库权限-系统权限" aria-hidden="true">#</a> 赋予数据库权限（系统权限）：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">SQL</span><span class="token operator">></span> grant create table <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">3.</span><span class="token function">431</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1700.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="赋予对象权限" tabindex="-1"><a class="header-anchor" href="#赋予对象权限" aria-hidden="true">#</a> 赋予对象权限:</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">SQL</span><span class="token operator">></span> grant select on dmhr<span class="token punctuation">.</span>employee <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">535</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1703.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看当前用户拥有的权限" tabindex="-1"><a class="header-anchor" href="#查看当前用户拥有的权限" aria-hidden="true">#</a> 查看当前用户拥有的权限：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from session_privs<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="权限的回收" tabindex="-1"><a class="header-anchor" href="#权限的回收" aria-hidden="true">#</a> 权限的回收：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">SQL</span><span class="token operator">></span> revoke select on dmhr<span class="token punctuation">.</span>employee from hrtest<span class="token punctuation">;</span>
## 操作已执行
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">792</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1704.</span>
<span class="token constant">SQL</span><span class="token operator">></span> revoke create table from hrtest<span class="token punctuation">;</span>
## 操作已执行
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">704</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1705</span>
## 赋予查询对象权限，精确到列
<span class="token constant">SQL</span><span class="token operator">></span> grant select <span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span> employee_name<span class="token punctuation">)</span> on dmhr<span class="token punctuation">.</span>employee <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
## 操作已执行
已用时间<span class="token operator">:</span> <span class="token number">2.</span><span class="token function">175</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">1706.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相关数据字典：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from dba_sys_privs t where t<span class="token punctuation">.</span><span class="token constant">GRANTEE</span><span class="token operator">=</span> <span class="token char">'HRTEST'</span><span class="token punctuation">;</span>
select <span class="token operator">*</span> from dba_role_privs t where t<span class="token punctuation">.</span><span class="token constant">GRANTEE</span><span class="token operator">=</span> <span class="token char">'HRTEST'</span><span class="token punctuation">;</span>
select <span class="token operator">*</span> from dba_tab_privs t where t<span class="token punctuation">.</span><span class="token constant">GRANTEE</span><span class="token operator">=</span> <span class="token char">'HRTEST'</span><span class="token punctuation">;</span>
<span class="token constant">DM</span> 默 认 不 能 授 予 用 户 在 其 他 模 式 下 数 据 定 义 （ <span class="token constant">DDL</span> ） 的 权 限 ， 由 参 数
<span class="token constant">ENABLE_DDL_ANY_PRIV</span> 指定，默认为 <span class="token number">0</span>。
grant select any table <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
select <span class="token operator">*</span> from v\$parameter t where name like '<span class="token operator">%</span><span class="token constant">ENABLE_DDL_ANY_PRIV</span><span class="token operator">%</span>'<span class="token punctuation">;</span>
alter <span class="token constant">SYSTEM</span> set '<span class="token constant">ENABLE_DDL_ANY_PRIV</span>' <span class="token operator">=</span> <span class="token number">1</span> both<span class="token punctuation">;</span> <span class="token operator">--</span>开启后可正常赋予权限
grant create any table <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
grant create any index <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="十一-角色管理" tabindex="-1"><a class="header-anchor" href="#十一-角色管理" aria-hidden="true">#</a> 十一 角色管理</h1>
<h2 id="角色类型" tabindex="-1"><a class="header-anchor" href="#角色类型" aria-hidden="true">#</a> 角色类型</h2>
<p>角色是权限的集合，角色使权限管理更加方便。
DBA：具有几乎所有权限（除审计和强制访问控制之外），默认赋给 SYSDBA 用户。
PUBLIC：具有对当前模式下对象的 DML 数据操作权限。
RESOURCE：具有在当前模式下对象定义权限（创建表 索引 视图等）；
SOI：具有查询 sys 开头系统表的权限；
VTI：具有查询 v$开头的动态视图权限（动态视图记录在 v$dynamic_tables，如果没有此权限，DM 管理工具上会报没有查询 v$视图权限）
DB_AUDIT_开头的角色是审计相关角色，具有审计相关权限，默认赋给 SYSAUDITOR。
DB_POLICY_开头的角色是安全相关角色，具有强制访问控制等权限，默认赋给 SYSSSO。</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from dba_roles<span class="token punctuation">;</span>
create role r1<span class="token punctuation">;</span>
grant create table <span class="token keyword">to</span> <span class="token namespace">r1</span><span class="token punctuation">;</span>
grant select on dmhr<span class="token punctuation">.</span>department <span class="token keyword">to</span> <span class="token namespace">r1</span><span class="token punctuation">;</span>
grant r1 <span class="token keyword">to</span> <span class="token namespace">hrtest</span><span class="token punctuation">;</span>
<span class="token function">sp_set_role</span><span class="token punctuation">(</span><span class="token char">'R1'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">--</span>角色禁用和启用，禁用后角色权限将不在生效。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>赋予对象权限增加 with grant option 说明权限可以转授，回收时要增加 cascade 关键字级联
回收权限，否则报错：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>revoke select on dmhr<span class="token punctuation">.</span>employee from r2 <span class="token constant">CASCADE</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="十二-数据库的备份还原" tabindex="-1"><a class="header-anchor" href="#十二-数据库的备份还原" aria-hidden="true">#</a> 十二 数据库的备份还原</h1>
<h2 id="备份还原基本概念" tabindex="-1"><a class="header-anchor" href="#备份还原基本概念" aria-hidden="true">#</a> 备份还原基本概念</h2>
<p>备份包含物理备份和逻辑备份。
物理备份是拷贝有效的数据页。逻辑备份是导出数据库中逻辑数据。
物理备份分为完全备份 增量备份；联机备份（热备）和脱机备份（冷备）。
完全备份是指一个备份包含指定数据库或表空间的所有数据；
增量备份是指在一次全备份或上一次增量备份后，以后每次的备份只需备份与前一次相比增加或者被修改的文件；
增量备份包含差异增量备份和累积增量备份，默认是差异增量备份。
差异增量备份的基础备份集可以是全量备份，也可以是增量备份；
累计增量备份的基备份集只能是全量备份。
热备：指数据库启动状态下的备份
冷备：指数据库关闭状态下的备份。
备份级别：全库备份 表空间级备份 表级备份 归档备份。
物理还原是备份的逆过程；
恢复是使用归档将数据库恢复到最新状态或指定时间点；或使用备份集中的 redo 信息将数据库恢复至一致性状态。</p>
<h2 id="备份-还原与恢复的关系" tabindex="-1"><a class="header-anchor" href="#备份-还原与恢复的关系" aria-hidden="true">#</a> 备份 还原与恢复的关系</h2>
<p>备份还原两个重要参数：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>select <span class="token operator">*</span> from v\$parameter t where name in <span class="token punctuation">(</span>'<span class="token constant">BAK_PATH</span><span class="token char">', '</span><span class="token constant">BAK_USE_AP</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>BAK_PATH：DM 默认的备份路径，生成环境不要和源库数据文件放在同一磁盘上。避免磁
盘损坏，数据文件和备份文件同时损坏的情况。
BAK_USE_AP：备份还原策略，默认使用 DMAP 辅助进程。</p>
<h2 id="查看-ap-服务是否启动" tabindex="-1"><a class="header-anchor" href="#查看-ap-服务是否启动" aria-hidden="true">#</a> 查看 AP 服务是否启动：</h2>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA04</span> bak<span class="token punctuation">]</span>$ ps <span class="token operator">-</span>ef<span class="token operator">|</span>grep dmap
dmdba <span class="token number">86474</span> <span class="token number">1</span> <span class="token number">0</span> <span class="token number">4</span> 月 <span class="token number">14</span> <span class="token operator">?</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">01</span> <span class="token operator">/</span>dm8<span class="token operator">/</span>bin<span class="token operator">/</span>dmap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 AP 服务没有启动，则备份报错：
[执行语句1]:</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>backup database<span class="token punctuation">;</span>
执行失败<span class="token punctuation">(</span>语句<span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">7170</span><span class="token operator">:</span> bakres 连接 <span class="token constant">DMAP</span> 失败
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="脱机备份与还原数据库" tabindex="-1"><a class="header-anchor" href="#脱机备份与还原数据库" aria-hidden="true">#</a> 脱机备份与还原数据库</h2>
<p>脱机备份（数据库关闭状态下的备份）
一 使用 dmrman 工具可以脱机备份
库备份（冷备）</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">RMAN</span><span class="token operator">></span> backup database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini'<span class="token punctuation">;</span>
backup database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini'<span class="token punctuation">;</span>
file dm<span class="token punctuation">.</span>key not found<span class="token punctuation">,</span> use <span class="token keyword">default</span> license<span class="token operator">!</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token constant">EP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>'s cur_lsn<span class="token punctuation">[</span><span class="token number">46292</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_lsn<span class="token punctuation">[</span><span class="token number">46292</span><span class="token punctuation">]</span>
<span class="token class-name">Processing</span> backupset <span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>bak<span class="token operator">/</span><span class="token constant">DB_DM_FULL_20211222_152753_249786</span>
<span class="token punctuation">[</span><span class="token class-name">Percent</span><span class="token operator">:</span><span class="token number">100.00</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Speed</span><span class="token operator">:</span><span class="token number">0.00</span>M<span class="token operator">/</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Cost</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Remaining</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span>
backup successfully<span class="token operator">!</span>
time used<span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">01.255</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="表空间的还原和恢复" tabindex="-1"><a class="header-anchor" href="#表空间的还原和恢复" aria-hidden="true">#</a> 表空间的还原和恢复</h2>
<p>测试删除普通表空间数据文件，演示普通表空间的还原于恢复。
DM8 表空间的还原与恢复需要在脱机状态下操作.
制造测试数据，然后删除表空间数据文件：</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA04</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ <span class="token class-name">DmServiceDMSERVER</span> start
<span class="token class-name">Starting</span> <span class="token class-name">DmServiceDMSERVER</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token constant">OK</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA04</span> <span class="token operator">~</span><span class="token punctuation">]</span>$ disql sysdba<span class="token operator">/</span><span class="token constant">SYSDBA</span>
服务器<span class="token punctuation">[</span><span class="token constant">LOCALHOST</span><span class="token operator">:</span><span class="token number">5236</span><span class="token punctuation">]</span><span class="token operator">:</span>处于普通打开状态
登录使用时间 <span class="token operator">:</span> <span class="token number">28.</span><span class="token function">250</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
disql <span class="token constant">V8</span>
<span class="token constant">SQL</span><span class="token operator">></span> select <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> from t_dept<span class="token punctuation">;</span>
行号 <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token number">46</span>
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">278</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">501.</span>
<span class="token constant">SQL</span><span class="token operator">></span> insert into t_dept select <span class="token operator">*</span> from dmhr<span class="token punctuation">.</span>department<span class="token punctuation">;</span>
<span class="token number">99</span> <span class="token operator">/</span> <span class="token number">118</span>
影响行数 <span class="token number">47</span>
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">972</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">502.</span>
<span class="token constant">SQL</span><span class="token operator">></span> commit<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">313</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">503.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> from t_dept<span class="token punctuation">;</span>
行号 <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token number">93</span>
已用时间<span class="token operator">:</span> <span class="token number">0.</span><span class="token function">318</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">504.</span>
<span class="token constant">SQL</span><span class="token operator">></span> insert into t_dept select <span class="token operator">*</span> from dmhr<span class="token punctuation">.</span>department<span class="token punctuation">;</span>
影响行数 <span class="token number">47</span>
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">972</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">502.</span>
<span class="token constant">SQL</span><span class="token operator">></span> commit<span class="token punctuation">;</span>
操作已执行
已用时间<span class="token operator">:</span> <span class="token number">1.</span><span class="token function">313</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">503.</span>
<span class="token constant">SQL</span><span class="token operator">></span> select <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> from t_dept<span class="token punctuation">;</span>
行号 <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token number">140</span>
<span class="token constant">SQL</span><span class="token operator">></span> select table_name<span class="token punctuation">,</span> tablespace_name<span class="token punctuation">,</span>owner from dba_tables t where t<span class="token punctuation">.</span>table_name<span class="token operator">=</span><span class="token char">'T_DEPT'</span><span class="token punctuation">;</span>
行号 <span class="token constant">TABLE_NAME</span> <span class="token constant">TABLESPACE_NAME</span> <span class="token constant">OWNER</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">1</span> <span class="token constant">T_DEPT</span> <span class="token constant">MAIN</span> <span class="token constant">SYSDBA</span>
已用时间<span class="token operator">:</span> <span class="token number">103.</span><span class="token function">392</span><span class="token punctuation">(</span>毫秒<span class="token punctuation">)</span><span class="token punctuation">.</span> 执行号<span class="token operator">:</span><span class="token number">600.</span>
<span class="token constant">SQL</span><span class="token operator">></span> host rm <span class="token constant">MAIN</span><span class="token punctuation">.</span><span class="token constant">DBF</span>
表空间 <span class="token constant">MAIN</span> 的还原与恢复演示：
<span class="token punctuation">[</span>dmdba<span class="token annotation punctuation">@KylinDCA04</span> full<span class="token punctuation">]</span>$ dmrman
dmrman <span class="token constant">V8</span>
<span class="token constant">RMAN</span><span class="token operator">></span> restore database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' tablespace main from backupset 
'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">CONSOLEFULLBAK</span>'<span class="token punctuation">;</span>
restore database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' tablespace main from backupset 
'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">CONSOLEFULLBAK</span>'<span class="token punctuation">;</span>
file dm<span class="token punctuation">.</span>key not found<span class="token punctuation">,</span> use <span class="token keyword">default</span> license<span class="token operator">!</span>
<span class="token number">100</span> <span class="token operator">/</span> <span class="token number">118</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token constant">EP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>'s cur_lsn<span class="token punctuation">[</span><span class="token number">1507247</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_lsn<span class="token punctuation">[</span><span class="token number">1507247</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Percent</span><span class="token operator">:</span><span class="token number">100.00</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Speed</span><span class="token operator">:</span><span class="token number">0.00</span>M<span class="token operator">/</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Cost</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Remaining</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span>
restore successfully<span class="token punctuation">.</span>
time used<span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02.595</span>
表空间的恢复系统会自动利用归档恢复到最新状态。
<span class="token constant">RMAN</span><span class="token operator">></span> recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' tablespace main<span class="token punctuation">;</span>
recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' tablespace main<span class="token punctuation">;</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token constant">EP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>'s cur_lsn<span class="token punctuation">[</span><span class="token number">1507247</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_lsn<span class="token punctuation">[</span><span class="token number">1507247</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Percent</span><span class="token operator">:</span><span class="token number">100.00</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Speed</span><span class="token operator">:</span><span class="token number">0.00</span><span class="token constant">PKG</span><span class="token operator">/</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Cost</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Remaining</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span>
recover successfully<span class="token punctuation">.</span>
time used<span class="token operator">:</span> <span class="token number">464.</span><span class="token function">414</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>全库的还原与恢复
测试场景：删除 system 数据文件
使用全量备份集或增量备份集进行还原和恢复步骤相同。
假如 a（全量）-&gt;b1(增量)-&gt; b2(增量)
-&gt; c1(增量)
如果全量备份丢失，基于其增量的备份也将无法正常使用</p>
<p>（1）数据库的还原</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">RMAN</span><span class="token operator">></span> restore database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' from backupset 
'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">ONLINEBAK_02</span>'<span class="token punctuation">;</span>
restore database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' from backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">ONLINEBAK_02</span>'<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token class-name">Percent</span><span class="token operator">:</span><span class="token number">0.00</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Speed</span><span class="token operator">:</span><span class="token number">0.00</span>M<span class="token operator">/</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Cost</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">01</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Remaining</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span><span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token punctuation">[</span><span class="token class-name">Percent</span><span class="token operator">:</span><span class="token number">100.00</span><span class="token operator">%</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Speed</span><span class="token operator">:</span><span class="token number">0.00</span>M<span class="token operator">/</span>s<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Cost</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Remaining</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token punctuation">]</span>
restore successfully<span class="token punctuation">.</span>
time used<span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02.330</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）数据库的恢复</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">RMAN</span><span class="token operator">></span> recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' <span class="token keyword">with</span> <span class="token namespace">archivedir</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>arch'<span class="token punctuation">;</span>
recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' <span class="token keyword">with</span> <span class="token namespace">archivedir</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>arch'<span class="token punctuation">;</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token constant">EP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>'s cur_lsn<span class="token punctuation">[</span><span class="token number">46002</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_lsn<span class="token punctuation">[</span><span class="token number">46002</span><span class="token punctuation">]</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">4</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">11</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">8</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">22</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">12</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">34</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">16</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">45</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">20</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">57</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">24</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">68</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">28</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">80</span><span class="token operator">%</span>
<span class="token number">102</span> <span class="token operator">/</span> <span class="token number">118</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">32</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">91</span><span class="token operator">%</span>
<span class="token constant">EP</span><span class="token operator">:</span><span class="token number">0</span> total <span class="token number">35</span> pkgs applied<span class="token punctuation">,</span> percent<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span>
recover successfully<span class="token operator">!</span>
time used<span class="token operator">:</span> <span class="token number">294.</span><span class="token function">062</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）更新数据库魔数</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code><span class="token constant">RMAN</span><span class="token operator">></span> recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' update db_magic<span class="token punctuation">;</span>
recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DM</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' update db_magic<span class="token punctuation">;</span>
<span class="token class-name">Database</span> mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oguid <span class="token operator">=</span> <span class="token number">0</span>
<span class="token class-name">Normal</span> of <span class="token constant">FAST</span>
<span class="token class-name">Normal</span> of <span class="token constant">DEFAULT</span>
<span class="token class-name">Normal</span> of <span class="token constant">RECYCLE</span>
<span class="token class-name">Normal</span> of <span class="token constant">KEEP</span>
<span class="token class-name">Normal</span> of <span class="token constant">ROLL</span>
<span class="token constant">EP</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>'s cur_lsn<span class="token punctuation">[</span><span class="token number">46292</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_lsn<span class="token punctuation">[</span><span class="token number">46292</span><span class="token punctuation">]</span>
recover successfully<span class="token operator">!</span>
time used<span class="token operator">:</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">01.009</span>
不完全恢复的使用场景：
表误删除（<span class="token constant">DROP</span>），可以指定归档恢复到删除的前一刻。
recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' <span class="token keyword">with</span> <span class="token namespace">archivedir</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>arch' until lsn <span class="token constant">XX</span><span class="token punctuation">;</span>
recover database '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DMTEST</span><span class="token operator">/</span>dm<span class="token punctuation">.</span>ini' <span class="token keyword">with</span> <span class="token namespace">archivedir</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>arch' until time <span class="token constant">XX</span><span class="token punctuation">;</span>
show 查看备份集
<span class="token constant">RMAN</span><span class="token operator">></span> show backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>bak_full'<span class="token punctuation">;</span>
remove 删除备份集
<span class="token constant">RMAN</span><span class="token operator">></span> remove backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>bak_increment'<span class="token punctuation">;</span>
check 检查备份集
<span class="token constant">RMAN</span><span class="token operator">></span> check backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>data<span class="token operator">/</span><span class="token constant">DAMENG</span><span class="token operator">/</span>bak_full'<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="联机备份与还原数据库" tabindex="-1"><a class="header-anchor" href="#联机备份与还原数据库" aria-hidden="true">#</a> 联机备份与还原数据库</h2>
<p>联机备份：数据库是启动状态，联机备份要求数据库打开归档。
备份时 AP 服务需要为启动状态。
SQL 备份数据库
备份数据库</p>
<div class="language-java line-numbers-mode" data-ext="java"><pre v-pre class="language-java"><code>backup database<span class="token punctuation">;</span> <span class="token operator">--</span>全量备份
backup database increment<span class="token punctuation">;</span> <span class="token operator">--</span>增量备份
backup database full <span class="token keyword">to</span> <span class="token constant">ONLINEBAK_01</span> backupset
'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">ONLINEBAK_01</span>'<span class="token punctuation">;</span>
backup database increment <span class="token constant">BASE</span> <span class="token constant">ON</span> <span class="token constant">BACKUPSET</span> 
'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span><span class="token constant">ONLINEBAK_01</span>' <span class="token keyword">to</span> <span class="token constant">ONLINEBAKINCR_01</span> 
backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>incr<span class="token operator">/</span><span class="token constant">ONLINEBAK_01</span>' <span class="token punctuation">;</span>
backup database increment <span class="token keyword">with</span> <span class="token constant">BACKUPDIR</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span>' <span class="token keyword">to</span>
<span class="token constant">ONLINEBAKINCR_02</span> backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>incr<span class="token operator">/</span><span class="token constant">ONLINEBAK_02</span>' <span class="token punctuation">;</span>
备份集管理
<span class="token operator">--</span>查看备份集
select <span class="token operator">*</span> from v\$backupset<span class="token punctuation">;</span>
<span class="token operator">--</span>备份集相关函数
select <span class="token operator">*</span> from v\$ifun t where t<span class="token punctuation">.</span>name like '<span class="token constant">SF_BAKSET</span><span class="token operator">%</span>'<span class="token punctuation">;</span>
<span class="token function">SF_BAKSET_BACKUP_DIR_ADD</span><span class="token punctuation">(</span><span class="token char">'DISK'</span><span class="token punctuation">,</span>'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">SF_BAKSET_BACKUP_DIR_ADD</span><span class="token punctuation">(</span><span class="token char">'DISK'</span><span class="token punctuation">,</span>'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>incr<span class="token operator">/</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span>校验备份集
select <span class="token function">SF_BAKSET_CHECK</span><span class="token punctuation">(</span><span class="token char">'DISK'</span><span class="token punctuation">,</span>'<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>incr<span class="token operator">/</span><span class="token constant">ONLINEBAK_02</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span>查看各个增量备份集的基础备份集：
select t<span class="token punctuation">.</span><span class="token constant">BACKUP_NAME</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token constant">BACKUP_PATH</span><span class="token punctuation">,</span> <span class="token constant">LEVEL</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
 <span class="token function">SYS_CONNECT_BY_PATH</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token constant">BACKUP_NAME</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token constant">BACKUP_BASECONNECT</span><span class="token punctuation">,</span>
 <span class="token constant">CONNECT_BY_ISLEAF</span> <span class="token class-name">ISLEAF</span>
 from <span class="token punctuation">(</span>select a<span class="token punctuation">.</span><span class="token constant">BACKUP_NAME</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token constant">BACKUP_PATH</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token constant">BASE_NAME</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token constant">TYPE</span>
 from v\$<span class="token class-name">BACKUPSET</span> a<span class="token punctuation">)</span> t 
connect by t<span class="token punctuation">.</span><span class="token constant">BASE_NAME</span> <span class="token operator">=</span> <span class="token constant">PRIOR</span> t<span class="token punctuation">.</span><span class="token constant">BACKUP_NAME</span> 
start <span class="token keyword">with</span> <span class="token namespace">t<span class="token punctuation">.</span>type</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
表空间备份
backup tablespace dmtbs<span class="token punctuation">;</span>
backup tablespace dmtbs <span class="token constant">INCREMENT</span> <span class="token keyword">with</span> <span class="token constant">BACKUPDIR</span> '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>full<span class="token operator">/</span>' <span class="token keyword">to</span>
<span class="token constant">DMTBSINCR_01</span> backupset '<span class="token operator">/</span>dm8<span class="token operator">/</span>backup<span class="token operator">/</span>incr<span class="token operator">/</span><span class="token constant">DMTBSINCR_01</span>' <span class="token punctuation">;</span>
表和归档的备份
backup table dmhr<span class="token punctuation">.</span>employee<span class="token punctuation">;</span> <span class="token operator">--</span>表的备份
backup archivelog all<span class="token punctuation">;</span> <span class="token operator">--</span>归档备份
库级 表空间的还原和恢复不支持联机恢复，只支持脱机还原恢复。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></template>


